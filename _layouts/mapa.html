---
layout: default
title: "Mapa"
---

<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{{ page.title }}</title>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

<style>
  #map { height: 500px; width: 100%; border-radius: 8px; margin-bottom: 20px; }
  .map-info { padding: 1rem; background: #f9f9f9; border-radius: 8px; }
  .map-info h2 { margin-top: 0; }
  video, audio, img { display: block; margin-top: 5px; max-width: 100%; border-radius:5px; }
</style>
</head>
<body>

<h1>{{ page.title }}</h1>

<div id="map"></div>

<div class="map-info">
  <h2>Consejos y Tips</h2>
  <p>{{ page.tips }}</p>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
/* --- Cargar datos directamente desde _mapas/ --- */
const mapsData = [
  {% for map in site.mapas %}
  {
    id: "{{ map.id }}",
    center: [{{ map.center | join: ',' }}],
    zoom: {{ map.zoom }},
    markers: {{ map.markers | jsonify }},
    route: {{ map.route | jsonify }},
    tips: {{ map.tips | jsonify }}
  }{% if forloop.last == false %},{% endif %}
  {% endfor %}
];

/* --- Inicializar mapa para el page.id actual --- */
function initMap(mapId) {
  const mapData = mapsData.find(m => m.id === mapId);
  if(!mapData) {
    console.error("Mapa no encontrado: ", mapId);
    return;
  }

  const map = L.map('map').setView(mapData.center, mapData.zoom);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors'
  }).addTo(map);

  // Marcadores
  mapData.markers.forEach(marker => {
    let popupContent = `<b>${marker.name}</b><br>${marker.popup || ''}`;
    if(marker.image) popupContent += `<br><img src="${marker.image}" alt="${marker.name}">`;
    if(marker.audio) popupContent += `<br><audio controls src="${marker.audio}"></audio>`;
    if(marker.video) popupContent += `<br><video controls src="${marker.video}" width="250"></video>`;
    L.marker(marker.coords).addTo(map).bindPopup(popupContent);
  });

  // Ruta
  if(mapData.route && mapData.route.length > 1){
    const polyline = L.polyline(mapData.route, { color: 'blue', weight: 4, opacity: 0.7 }).addTo(map);
    map.fitBounds(polyline.getBounds());
  }

  // Mostrar tips
  document.querySelector('.map-info p').innerHTML = mapData.tips;
}

/* --- Llamar a la funci√≥n con page.id --- */
initMap("{{ page.id }}");
</script>

</body>
</html>
