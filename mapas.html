---
layout: default
title: "Mapas"
---

<h1>{{ page.title }}</h1>

<label for="categoryFilter">Filtrar por categoría:</label>
<select id="categoryFilter" onchange="filterMaps()">
  <option value="all">Todas</option>
  {% assign categories = site.mapas | map: "category" | uniq %}
  {% for cat in categories %}
    <option value="{{ cat }}">{{ cat }}</option>
  {% endfor %}
</select>

<div class="map-list">
  {% for map in site.mapas %}
    <div class="map-item" data-category="{{ map.category }}" data-index="{{ forloop.index0 }}">
      <a href="#" class="map-link" target="_blank">
        <div id="thumb-{{ forloop.index0 }}" class="map-thumb"></div>
      </a>
      <h3 class="map-title">{{ map.title }}</h3>
      {% if map.tips %}
        <p class="map-tips">{{ map.tips }}</p>
      {% endif %}
      <a href="#" class="gm-btn" target="_blank">Abrir en Google Maps</a>
    </div>
  {% endfor %}
</div>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
.map-list {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
}
.map-item {
  flex: 1 1 calc(33% - 20px);
  min-width: 250px;
  display: flex;
  flex-direction: column;
  align-items: center;
  border: 1px solid #ddd;
  border-radius: 8px;
  padding: 10px;
  background: #fff;
}
.map-thumb {
  width: 100%;
  height: 150px;
  border-radius: 8px;
  margin-bottom: 5px;
}
.map-title {
  margin: 5px 0 3px;
  text-align: center;
}
.map-tips {
  font-size: 0.9rem;
  text-align: center;
  margin: 0 0 5px;
  color: #555;
}
.gm-btn {
  padding: 5px 10px;
  background: #0077cc;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  text-align: center;
  margin-bottom: 10px;
  text-decoration: none;
}
.gm-btn:hover { background: #005fa3; }

@media (max-width: 992px) { .map-item { flex: 1 1 calc(50% - 20px); } }
@media (max-width: 600px) { .map-item { flex: 1 1 100%; } }
</style>

<script>
document.addEventListener("DOMContentLoaded", function(){

  const mapsData = [
    {% for map in site.mapas %}
    {
      index: {{ forloop.index0 }},
      title: {{ map.title | jsonify }},
      center: {{ map.center | jsonify }},
      zoom: {{ map.zoom | default: 13 }},
      markers: {{ map.markers | jsonify }},
      route: {{ map.route | jsonify }}
    },
    {% endfor %}
  ];

  mapsData.forEach(map => {
    // Inicializar Leaflet
    const thumbEl = document.getElementById('thumb-' + map.index);
    const mapThumb = L.map(thumbEl, { zoomControl:false, dragging:false, scrollWheelZoom:false, attributionControl:false }).setView(map.center, map.zoom);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(mapThumb);

    if(map.markers) map.markers.forEach(m => L.marker(m.coords).addTo(mapThumb));
    if(map.route && map.route.length>1){
      const line = L.polyline(map.route, { color:'blue', weight:3 }).addTo(mapThumb);
      mapThumb.fitBounds(line.getBounds());
    }

    // Crear enlace Google Maps
    const origin = (map.route && map.route.length>0) ? map.route[0] : map.center;
    const destination = (map.route && map.route.length>1) ? map.route[map.route.length-1] : map.center;
    const gmapsURL = (map.route && map.route.length>1) ?
      `https://www.google.com/maps/dir/${origin[0]},${origin[1]}/${destination[0]},${destination[1]}` :
      `https://www.google.com/maps/search/?api=1&query=${map.center[0]},${map.center[1]}`;

    // Asignar href al div y al botón
    const mapLink = thumbEl.closest('.map-item').querySelector('.map-link');
    mapLink.href = gmapsURL;

    const gmBtn = thumbEl.closest('.map-item').querySelector('.gm-btn');
    gmBtn.href = gmapsURL;

    // Clic en la miniatura también abre Google Maps
    thumbEl.addEventListener('click', () => {
      window.open(gmapsURL, '_blank');
    });
  });

});

// Filtrado
function filterMaps(){
  const filter = document.getElementById('categoryFilter').value;
  document.querySelectorAll('.map-item').forEach(item => {
    if(filter==='all' || item.dataset.category===filter) item.style.display='flex';
    else item.style.display='none';
  });
}
</script>
